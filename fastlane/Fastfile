fastlane_version "1.66.0"

desc "Test iOS, tvOS, and OSX"
lane :test do
    test_swift_2
    test_swift_3
    coverage
end

lane :localcoverage do
    coverage
    sh('cd .. && slather coverage --scheme SentrySwift-iOS --ignore "*ViewController.swift" --ignore "AppDelegate.swift" SentrySwift.xcodeproj')
end

lane :lint do 
    sh('cd .. && swiftlint')
end

lane :test_swift_2 do
    xcargs = "SWIFT_VERSION=\"2.3\""
    clear_derived_data
    scan(scheme: "SentrySwift-iOS", device: "iPhone 6 Plus (9.3)", xcargs: xcargs, clean: true)
    scan(scheme: "SentrySwift-tvOS", device: "Apple TV 1080p", xcargs: xcargs, clean: true)
    scan(scheme: "SentrySwift-OSX", destination: "platform=macOS", xcargs: xcargs, clean: true)
end

lane :test_swift_3 do
    clear_derived_data
    scan(scheme: "SentrySwift-tvOS", device: "Apple TV 1080p", clean: true)
    scan(scheme: "SentrySwift-OSX", destination: "platform=macOS", clean: true)
end

lane :coverage do
    clear_derived_data
    scan(scheme: "SentrySwift-iOS", device: "iPhone 6 Plus (10.0)", clean: true, code_coverage: true)
    sh('cd .. && slather coverage -x --scheme SentrySwift-iOS --ignore "*ViewController.swift" SentrySwift.xcodeproj')
end